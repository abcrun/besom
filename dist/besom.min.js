/**
 * @license MIT
 * @author abcrun
 **/
!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e():t.Besom=e()}(this,function(){function b(t){return Math.round(1e3*parseFloat(t))/1e3}var l="ontouchend"in document,c=function(t){if("string"==typeof t){var e=(/matrix\((.*)\)/.exec(t)||["",""])[1].split(",");t=6<=e.length?[[b(e[0]),b(e[2]),b(e[4])],[b(e[1]),b(e[3]),b(e[5])],[0,0,1]]:[[1,0,0],[0,1,0],[0,0,1]]}return t},u=function(t,e){for(var n=[],i=0;i<t.length;i++){for(var o=[],s=0;s<e[i].length;s++)o.push(b(t[i][0]*e[0][s]+t[i][1]*e[1][s]+t[i][2]*e[2][s]));n.push(o)}return n},M=function(t){var e=t[0][0],n=t[1][0],i=t[0][1],o=t[1][1],s=t[0][2],a=t[1][2],r=Math.atan2(n,e)*(180/Math.PI),l=-Math.PI/180*r;return{scale:{x:b(Math.sqrt(e*e+n*n)),y:b(Math.sqrt(i*i+o*o))},rotate:b(r),translate:{x:b(Math.cos(l)*s-Math.sin(l)*a),y:b(Math.sin(l)*s+Math.cos(l)*a)}}},v=(t.prototype={offset:function(){for(var t=(o=this.element).offsetLeft,e=o.offsetTop,n=o.offsetWidth,i=o.offsetHeight;o.offsetParent;){var o;t+=(o=o.offsetParent).offsetLeft,e+=o.offsetTop}return{left:t,top:e,width:n,height:i}},getPointOrigin:function(t){var e=this.offset(),n=this.transform,i=Math.PI/180,o=T(this.element),s=M(o),a=n.origin,r=n.scale.x,l=n.rotate,f=s.translate.x,h=s.translate.y,u=t.pageX-e.left,c=t.pageY-e.top,v=a.x-u,p=a.y-c;v=0==v?.1:v,p=0==p?.1:p;var g,d,m=Math.sqrt(v*v+p*p)/r,x=Math.atan(Math.abs(p/v))/i;0<p&&0<v&&(toangle=x-l),0<p&&v<0&&(toangle=180-x-l),p<0&&0<v&&(toangle=x+l),p<0&&v<0&&(toangle=x-l);var y=m*Math.cos(toangle*i),w=m*Math.sin(toangle*i);return 0<p&&0<v&&(g=a.x-y)&&(d=a.y-w),0<p&&v<0&&(g=a.x-y)&&(d=a.y-w),p<0&&0<v&&(g=a.x-y)&&(d=a.y+w),p<0&&v<0&&(g=a.x+y)&&(d=a.y+w),{x:b(g-f/r),y:b(d-h/r)}},setPointAsOrigin:function(t){var e=this.transform.origin,n=T(this.element),i=this.getPointOrigin(t),o=e.x-i.x,s=e.y-i.y,a=u(n,[[-o],[-s],[1]]),r=a[0][0]+e.x,l=a[1][0]+e.y,f=r-e.x,h=e.y-l;p.call(this,{translate:{x:o+f,y:s-h},origin:i})},translate:function(t,e){if(t){var n=this.transform.translate,i=n.x,o=n.y,s={x:i+t.x,y:o+t.y};p.call(this,{translate:s},e)}},scale:function(t,e){if(t){var n=this.transform.scale.x;p.call(this,{scale:t*n},e)}},rotate:function(t,e){if(t){var n=this.transform.rotate;p.call(this,{rotate:n+t},e)}},position:function(){var t=this.element,e=window.getComputedStyle(t,!1),n=parseInt(e.left),i=parseInt(e.top);return{left:isNaN(n)?0:n,top:isNaN(i)?0:i}},move:function(t,e){var n=this.element,i=n.style.cssText||"",o=(e=e||"0s",t.left),s=t.top,a=t.width,r=t.height,l="-webkit-transition:"+e+";",f="";void 0!==o&&(l+="left:"+o+"px;",f="left"),void 0!==s&&(l+="top:"+s+"px;",f+=",top;"),void 0!==a&&(l+="width:"+a+"px;"),void 0!==r&&(l+="height:"+r+"px;"),n.style.cssText=i+";"+l+(f?"transition-property:"+f:"")}},t);function T(t){var e=window.getComputedStyle(t,!1);return c("none"!=e.transform?e.transform:"matrix(1,0,0,1,0,0)")}function p(t,e){var n=this.element,i=n.style.cssText||"",o=this.transform,s=(e=e||"0s",t.origin||o.origin),a=t.translate||o.translate,r=t.scale||o.scale.x,l=t.rotate||o.rotate,f=(e="-webkit-transition:"+e+";","-webkit-transform: translate("+b(a.x)+"px, "+b(a.y)+"px) scale("+b(r)+") rotate("+b(l)+"deg);"),h="-webkit-transform-origin:"+b(s.x)+"px "+b(s.y)+"px;";n.style.cssText=i+";"+e+f+h}function t(t){this.element=t,this.transform=function(t){var e=t.style?t.style.cssText:"";if(rt=/translate\((.+)\)/i.exec(e)||[],rs=/scale\((.+)\)/i.exec(e)||[],rr=/rotate\((.+)\)/i.exec(e)||[],ro=/origin:\s*([^;]+)/i.exec(e)||[],rt.length&&rs.length&&rr.length&&ro.length){var n=rt[1].split(","),i=rs[1],o=rr[1],s=ro[1].split(" ");f={translate:{x:b(n[0]),y:b(n[1])},scale:{x:b(i),y:b(i)},rotate:b(o),origin:{x:b(s[0]),y:b(s[1])}}}else{var a=window.getComputedStyle(t,!1),r=c("none"!=a.transform?a.transform:"matrix(1,0,0,1,0,0)"),l=a["transform-origin"].split(" "),f=M(r),h=b(l[0]),u=b(l[1]);f.origin={x:h,y:u}}return f}(t)}function q(t,e){var n=e.pageX-t.pageX,i=e.pageY-t.pageY;return{offsetx:n,offsety:i,length:Math.sqrt(n*n+i*i)}}function f(t){var e=t.touches&&t.touches.length?t.touches:t.changedTouches&&t.changedTouches.length?t.changedTouches:[t],n={time:(new Date).getTime(),count:e.length,events:e};if(2==e.length){var i=e[0],o=e[1],s=q(i,o),a=s.offsetx,r=s.offsety,l=s.length,f=Math.sqrt(l*l/4-r*r/4),h=i.pageY+r/2,u=i.pageX+(a<0?-f:f);n.length=l,n.center={pageX:u,pageY:h}}return n}function A(t,e,n){var i,o=[e,n],s=this.events,a=this.element,r=n.events[0].target;if(s=this.events[t]){t:for(;r!=a;){var l=r.getAttribute("__gid");if(l){i=s[l];break t}var f=(r.className||"").split(" ");e:for(var h=0;h<f.length;h++){var u=f[h];if(u&&s[u]){r.setAttribute("__gid",u),i=s[u];break e}}if(i)break t;r=r.parentNode}i=i||s[g]}if(i){var c=new v(r);o.push(c),i.apply(c,o)}}function e(){function T(t){return-1<O.enabled.indexOf(t)}function i(t){t.preventDefault(),t.stopPropagation()}function t(t){i(t),L=f(t),A.call(O,"start",L,L),o.addEventListener(l?"touchmove":"mousemove",a,!1),o.addEventListener(l?"touchend":"mouseup",r,!1),o.addEventListener(l?"touchcancel":"mouseleave",r,!1)}var _,E,L,P,O=this,o=this.element,k=function(){if(L&&P){var t=L.events,e=P.events,n=q(t[0],e[0]);if(1==L.count&&1==P.count&&T("slide")&&3<n.length){var i={x:n.offsetx,y:n.offsety};E=E||{x:0,y:0},P.translate={x:i.x-E.x,y:i.y-E.y},E=i,_="slide"}else if(2==L.count&&2==P.count){var o=L.length,s=P.length,a=Math.PI/180,r=s/o,l=q(e[1],t[1]),f=n.length+l.length,h=(o*o+s*s-f*f)/(2*o*s),u=Math.acos(h<-1?-1:1<h?1:h)/a;if(!_)if(T("pinch")&&T("rotate"))if(.02<Math.abs(r-1))_="pinch";else{if(!(1<Math.abs(u)))return;_="rotate"}else _=T("pinch")?"pinch":"rotate";if("pinch"==_)null==E&&(E=1),P.scale=r/E,E=r;else if("rotate"==_&&null!=u){null==E&&(E=0);var c=L.center,v=t[0],p=e[0],g=q(c,v),d=q(c,p),m=t[1],x=e[1],y=q(c,m),w=q(c,x),b=g.offsetx*d.offsety-g.offsety*d.offsetx,M=y.offsetx*w.offsety-y.offsety*w.offsetx;u=b<0||M<0?-u:u,P.rotate=u-E,E=u}}P.total=E,_&&A.call(O,_,P,L),I(k)}},s=!1,a=function(t){i(t),P=f(t),!s&&(T("slide")||T("roate")||T("pinch"))&&(I(k),s=!0)},r=function(t){if(!t.touches||0==t.touches.length){i(t);L.events;var e=f(t),n=(e.events,e.time-L.time);e.duration=n,_?A.call(O,_+"End",e,L):function(t,e){var n=t.duration,i=this.__lastTouch,o=i&&t.time-i.time<300?"doubletap":n<200?"tap":"longtap";if("tap"==o&&(this.__lastTouch=t),setTimeout(function(){O.__lastTouch=null},300),"tap"==o&&T("doubletap")){var s=setTimeout(function(){A.call(O,"tap",t,e)},300);this.__lastTouch.itv=s}else i&&i.itv&&clearTimeout(i.itv),T(o)&&A.call(this,o,t,e)}.call(O,e,L),P=L=null,s=!1,E=_=void 0,o.removeEventListener(l?"touchmove":"mousemove",a,!1),o.removeEventListener(l?"touchend":"mouseup",r,!1),o.removeEventListener(l?"touchcancel":"mouseleave",r,!1)}};return o.addEventListener(l?"touchstart":"mousedown",t,!1),t}function n(t){this.element=t||document.body,this.events={},this.enabled=["tap"],this.element.setAttribute("__gid",g),this.__evtfn=e.call(this)}var I=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},g="besom-gid-root";return n.prototype={enable:function(){for(var t=["tap","longtap","doubletap","slide","pinch","rotate"],e=0;e<arguments.length;e++){var n=arguments[e];if(!(-1<t.indexOf(n)))throw new Error('Only Support: "'+t.join("|")+'"!');this.enabled.indexOf(n)<0&&this.enabled.push(n)}},disable:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t],n=this.enabled.indexOf(e);-1<n&&this.enabled.splice(n,1)}},on:function(t,e){this.events[t]=this.events[t]||{},this.events[t][g]=e},delegate:function(t,e,n){if(t.indexOf(".")<0)throw new Error('The arguments[0] shoud start width "."!');t=t.substring(1),this.events[e]=this.events[e]||{},this.events[e][t]=n},destroy:function(){this.element.removeEventListener(l?"touchstart":"mousedown",this.__evtfn,!1),this.__evtfn,this.element=null,this.events={}}},{create:function(t){return new n(t)},element:function(t){return new v(t)}}});