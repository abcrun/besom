/**
 * @license MIT
 * @author abcrun
 **/
!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e():t.Besom=e()}(this,function(){function w(t){return Math.round(1e3*parseFloat(t))/1e3}var l="ontouchend"in document,c=function(t){if("string"==typeof t){var e=(/matrix\((.*)\)/.exec(t)||["",""])[1].split(",");t=6<=e.length?[[w(e[0]),w(e[2]),w(e[4])],[w(e[1]),w(e[3]),w(e[5])],[0,0,1]]:[[1,0,0],[0,1,0],[0,0,1]]}return t},u=function(t,e){for(var n=[],o=0;o<t.length;o++){for(var a=[],s=0;s<e[o].length;s++)a.push(w(t[o][0]*e[0][s]+t[o][1]*e[1][s]+t[o][2]*e[2][s]));n.push(a)}return n},M=function(t){var e=t[0][0],n=t[1][0],o=t[0][1],a=t[1][1],s=t[0][2],r=t[1][2],i=Math.atan2(n,e)*(180/Math.PI),l=-Math.PI/180*i;return{scale:{x:w(Math.sqrt(e*e+n*n)),y:w(Math.sqrt(o*o+a*a))},rotate:w(i),translate:{x:w(Math.cos(l)*s-Math.sin(l)*r),y:w(Math.sin(l)*s+Math.cos(l)*r)}}},v=(t.prototype={offset:function(){for(var t=(n=this.element).offsetLeft,e=n.offsetTop;n.offsetParent;){var n;t+=(n=n.offsetParent).offsetLeft,e+=n.offsetTop}return{left:t,top:e}},getPointOrigin:function(t){var e=this.offset(),n=this.transform,o=Math.PI/180,a=_(this.element),s=M(a),r=n.origin,i=n.scale.x,l=n.rotate,f=s.translate.x,h=s.translate.y,u=t.pageX-e.left,c=t.pageY-e.top,v=r.x-u,g=r.y-c;v=0==v?.1:v,g=0==g?.1:g;var m,d,p=Math.sqrt(v*v+g*g)/i,x=Math.atan(Math.abs(g/v))/o;0<g&&0<v&&(toangle=x-l),0<g&&v<0&&(toangle=180-x-l),g<0&&0<v&&(toangle=x+l),g<0&&v<0&&(toangle=x-l);var y=p*Math.cos(toangle*o),b=p*Math.sin(toangle*o);return 0<g&&0<v&&(m=r.x-y)&&(d=r.y-b),0<g&&v<0&&(m=r.x-y)&&(d=r.y-b),g<0&&0<v&&(m=r.x-y)&&(d=r.y+b),g<0&&v<0&&(m=r.x+y)&&(d=r.y+b),{x:w(m-f/i),y:w(d-h/i)}},setPointAsOrigin:function(t){var e=this.transform.origin,n=_(this.element),o=this.getPointOrigin(t),a=e.x-o.x,s=e.y-o.y,r=u(n,[[-a],[-s],[1]]),i=r[0][0]+e.x,l=r[1][0]+e.y,f=i-e.x,h=e.y-l;g.call(this,{translate:{x:a+f,y:s-h},origin:o})},translate:function(t,e){if(t){var n=this.transform.translate,o=n.x,a=n.y,s={x:o+t.x,y:a+t.y};g.call(this,{translate:s},e)}},scale:function(t,e){if(t){var n=this.transform.scale.x,o=t*n;console.log(t,n),g.call(this,{scale:o},e)}},rotate:function(t,e){if(t){var n=this.transform.rotate;g.call(this,{rotate:n+t},e)}}},t);function _(t){var e=window.getComputedStyle(t,!1);return c("none"!=e.transform?e.transform:"matrix(1,0,0,1,0,0)")}function g(t,e){var n=this.element,o=n.style.cssText||"",a=this.transform,s=(e=e||"0s",t.origin||a.origin),r=t.translate||a.translate,i=t.scale||a.scale.x,l=t.rotate||a.rotate,f=(e="-webkit-transition:"+e+";","-webkit-transform: translate("+w(r.x)+"px, "+w(r.y)+"px) scale("+w(i)+") rotate("+w(l)+"deg);"),h="-webkit-transform-origin:"+w(s.x)+"px "+w(s.y)+"px;";n.style.cssText=o+";"+e+f+h}function t(t){this.element=t,this.transform=function(t){var e=t.style?t.style.cssText:"";if(rt=/translate\((.+)\)/i.exec(e)||[],rs=/scale\((.+)\)/i.exec(e)||[],rr=/rotate\((.+)\)/i.exec(e)||[],ro=/origin:\s*([^;]+)/i.exec(e)||[],rt.length&&rs.length&&rr.length&&ro.length){var n=rt[1].split(","),o=rs[1],a=rr[1],s=ro[1].split(" ");f={translate:{x:w(n[0]),y:w(n[1])},scale:{x:w(o),y:w(o)},rotate:w(a),origin:{x:w(s[0]),y:w(s[1])}}}else{var r=window.getComputedStyle(t,!1),i=c("none"!=r.transform?r.transform:"matrix(1,0,0,1,0,0)"),l=r["transform-origin"].split(" "),f=M(i),h=w(l[0]),u=w(l[1]);f.origin={x:h,y:u}}return f}(t)}function q(t,e){var n=e.pageX-t.pageX,o=e.pageY-t.pageY;return{offsetx:n,offsety:o,length:Math.sqrt(n*n+o*o)}}function f(t){var e=t.touches&&t.touches.length?t.touches:t.changedTouches&&t.changedTouches.length?t.changedTouches:[t],n={time:(new Date).getTime(),count:e.length,events:e};if(2==e.length){var o=e[0],a=e[1],s=q(o,a),r=s.offsetx,i=s.offsety,l=s.length,f=Math.sqrt(l*l/4-i*i/4),h=o.pageY+i/2,u=o.pageX+(r<0?-f:f);n.length=l,n.center={pageX:u,pageY:h}}return n}function A(t,e,n){var o,a=[e,n],s=this.events,r=this.element,i=n.events[0].target;if(s=this.events[t]){t:for(;i!=r;){var l=i.getAttribute("__gid");if(l){o=s[l];break t}var f=(i.className||"").split(" ");e:for(var h=0;h<f.length;h++){var u=f[h];if(u&&s[u]){i.setAttribute("__gid",u),o=s[u];break e}}if(o)break t;i=i.parentNode}o=o||s[m]}o&&o.apply(new v(i),a)}function e(){function _(t){return-1<O.enabled.indexOf(t)}function o(t){t.preventDefault(),t.stopPropagation()}function t(t){o(t),L=f(t),A.call(O,"start",L,L),a.addEventListener(l?"touchmove":"mousemove",r,!1),a.addEventListener(l?"touchend":"mouseup",i,!1),a.addEventListener(l?"touchcancel":"mouseleave",i,!1)}var T,E,L,P,O=this,a=this.element,k=function(){if(L&&P){var t=L.events,e=P.events,n=q(t[0],e[0]);if(1==L.count&&1==P.count&&_("slide")&&3<n.length){var o={x:n.offsetx,y:n.offsety};E=E||{x:0,y:0},P.translate={x:o.x-E.x,y:o.y-E.y},E=o,T="slide"}else if(2==L.count&&2==P.count){var a=L.length,s=P.length,r=Math.PI/180,i=s/a,l=q(e[1],t[1]),f=n.length+l.length,h=(a*a+s*s-f*f)/(2*a*s),u=Math.acos(h<-1?-1:1<h?1:h)/r;if(!T)if(_("pinch")&&_("rotate"))if(.02<Math.abs(i-1))T="pinch";else{if(!(1<Math.abs(u)))return;T="rotate"}else T=_("pinch")?"pinch":"rotate";if("pinch"==T)null==E&&(E=1),P.scale=i/E,E=i;else if("rotate"==T&&null!=u){null==E&&(E=0);var c=L.center,v=t[0],g=e[0],m=q(c,v),d=q(c,g),p=t[1],x=e[1],y=q(c,p),b=q(c,x),w=m.offsetx*d.offsety-m.offsety*d.offsetx,M=y.offsetx*b.offsety-y.offsety*b.offsetx;u=w<0||M<0?-u:u,P.rotate=u-E,E=u}}T&&A.call(O,T,P,L),X(k)}},s=!1,r=function(t){o(t),P=f(t),!s&&(_("slide")||_("roate")||_("pinch"))&&(X(k),s=!0)},i=function(t){if(!t.touches||0==t.touches.length){o(t);L.events;var e=f(t),n=(e.events,e.time-L.time);e.duration=n,T?A.call(O,T+"End",L,e):function(t,e){var n=t.duration,o=this.__lastTouch,a=o&&t.time-o.time<300?"doubletap":n<200?"tap":"longtap";if("tap"==a&&(this.__lastTouch=t),setTimeout(function(){O.__lastTouch=null},300),"tap"==a&&_("doubletap")){var s=setTimeout(function(){A.call(O,"tap",t,e)},300);this.__lastTouch.itv=s}else o&&o.itv&&clearTimeout(o.itv),_(a)&&A.call(this,a,t,e)}.call(O,e,L),P=L=null,s=!1,E=T=void 0,a.removeEventListener(l?"touchmove":"mousemove",r,!1),a.removeEventListener(l?"touchend":"mouseup",i,!1),a.removeEventListener(l?"touchcancel":"mouseleave",i,!1)}};return a.addEventListener(l?"touchstart":"mousedown",t,!1),t}function n(t){this.element=t||document.body,this.events={},this.enabled=["tap"],this.element.setAttribute("__gid",m),this.__evtfn=e.call(this)}var X=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},m="besom-gid-root";return n.prototype={enable:function(){for(var t=["tap","longtap","doubletap","slide","pinch","rotate"],e=0;e<arguments.length;e++){var n=arguments[e];if(!(-1<t.indexOf(n)))throw new Error('Only Support: "'+t.join("|")+'"!');this.enabled.indexOf(n)<0&&this.enabled.push(n)}},disable:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t],n=this.enabled.indexOf(e);-1<n&&this.enabled.splice(n,1)}},on:function(t,e){this.events[t]=this.events[t]||{},this.events[t][m]=e},delegate:function(t,e,n){if(t.indexOf(".")<0)throw new Error('The arguments[0] shoud start width "."!');t=t.substring(1),this.events[e]=this.events[e]||{},this.events[e][t]=n},destroy:function(){this.element.removeEventListener(l?"touchstart":"mousedown",this.__evtfn,!1),this.__evtfn,this.element=null,this.events={}}},{create:function(t){return new n(t)},element:function(t){return new v(t)}}});