/**
 * @license MIT
 * @author abcrun
 **/
!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e():t.Besom=e()}(this,function(){function w(t){return Math.round(1e3*parseFloat(t))/1e3}var l="ontouchend"in document,c=function(t){if("string"==typeof t){var e=(/matrix\((.*)\)/.exec(t)||["",""])[1].split(",");t=6<=e.length?[[w(e[0]),w(e[2]),w(e[4])],[w(e[1]),w(e[3]),w(e[5])],[0,0,1]]:[[1,0,0],[0,1,0],[0,0,1]]}return t},u=function(t,e){for(var n=[],o=0;o<t.length;o++){for(var i=[],s=0;s<e[o].length;s++)i.push(w(t[o][0]*e[0][s]+t[o][1]*e[1][s]+t[o][2]*e[2][s]));n.push(i)}return n},M=function(t){var e=t[0][0],n=t[1][0],o=t[0][1],i=t[1][1],s=t[0][2],a=t[1][2],r=Math.atan2(n,e)*(180/Math.PI),l=-Math.PI/180*r;return{scale:{x:w(Math.sqrt(e*e+n*n)),y:w(Math.sqrt(o*o+i*i))},rotate:w(r),translate:{x:w(Math.cos(l)*s-Math.sin(l)*a),y:w(Math.sin(l)*s+Math.cos(l)*a)}}},v=(t.prototype={offset:function(){for(var t=(i=this.element).offsetLeft,e=i.offsetTop,n=i.offsetWidth,o=i.offsetHeight;i.offsetParent;){var i;t+=(i=i.offsetParent).offsetLeft,e+=i.offsetTop}return{left:t,top:e,width:n,height:o}},getPointOrigin:function(t){var e=this.offset(),n=this.transform,o=Math.PI/180,i=T(this.element),s=M(i),a=n.origin,r=n.scale.x,l=n.rotate,f=s.translate.x,h=s.translate.y,u=t.pageX-e.left,c=t.pageY-e.top,v=a.x-u,g=a.y-c;v=0==v?.1:v,g=0==g?.1:g;var p,d,m=Math.sqrt(v*v+g*g)/r,x=Math.atan(Math.abs(g/v))/o;0<g&&0<v&&(toangle=x-l),0<g&&v<0&&(toangle=180-x-l),g<0&&0<v&&(toangle=x+l),g<0&&v<0&&(toangle=x-l);var y=m*Math.cos(toangle*o),b=m*Math.sin(toangle*o);return 0<g&&0<v&&(p=a.x-y)&&(d=a.y-b),0<g&&v<0&&(p=a.x-y)&&(d=a.y-b),g<0&&0<v&&(p=a.x-y)&&(d=a.y+b),g<0&&v<0&&(p=a.x+y)&&(d=a.y+b),{x:w(p-f/r),y:w(d-h/r)}},setPointAsOrigin:function(t){var e=this.transform.origin,n=T(this.element),o=this.getPointOrigin(t),i=e.x-o.x,s=e.y-o.y,a=u(n,[[-i],[-s],[1]]),r=a[0][0]+e.x,l=a[1][0]+e.y,f=r-e.x,h=e.y-l;g.call(this,{translate:{x:i+f,y:s-h},origin:o})},translate:function(t,e){if(t){var n=this.transform.translate,o=n.x,i=n.y,s={x:o+t.x,y:i+t.y};g.call(this,{translate:s},e)}},scale:function(t,e){if(t){var n=this.transform.scale.x;g.call(this,{scale:t*n},e)}},rotate:function(t,e){if(t){var n=this.transform.rotate;g.call(this,{rotate:n+t},e)}},pos:function(t,e){var n=this.element,o=n.style.cssText||"",i=(e=e||"0s",t.left),s=t.top,a=t.width,r=t.height,l="-webkit-transition:"+e+";",f="";void 0!==i&&(l+="left:"+i+"px;",f="left"),void 0!==s&&(l+="top:"+s+"px;",f+=",top;"),void 0!==a&&(l+="width:"+a+"px;"),void 0!==r&&(l+="height:"+r+"px;"),console.log(o+";"+l+f?"-webkit-transition-property:"+f:""),n.style.cssText=o+";"+l+(f?"-webkit-transition-property:"+f:"")}},t);function T(t){var e=window.getComputedStyle(t,!1);return c("none"!=e.transform?e.transform:"matrix(1,0,0,1,0,0)")}function g(t,e){var n=this.element,o=n.style.cssText||"",i=this.transform,s=(e=e||"0s",t.origin||i.origin),a=t.translate||i.translate,r=t.scale||i.scale.x,l=t.rotate||i.rotate,f=(e="-webkit-transition:"+e+";","-webkit-transform: translate("+w(a.x)+"px, "+w(a.y)+"px) scale("+w(r)+") rotate("+w(l)+"deg);"),h="-webkit-transform-origin:"+w(s.x)+"px "+w(s.y)+"px;";n.style.cssText=o+";"+e+f+h}function t(t){this.element=t,this.transform=function(t){var e=t.style?t.style.cssText:"";if(rt=/translate\((.+)\)/i.exec(e)||[],rs=/scale\((.+)\)/i.exec(e)||[],rr=/rotate\((.+)\)/i.exec(e)||[],ro=/origin:\s*([^;]+)/i.exec(e)||[],rt.length&&rs.length&&rr.length&&ro.length){var n=rt[1].split(","),o=rs[1],i=rr[1],s=ro[1].split(" ");f={translate:{x:w(n[0]),y:w(n[1])},scale:{x:w(o),y:w(o)},rotate:w(i),origin:{x:w(s[0]),y:w(s[1])}}}else{var a=window.getComputedStyle(t,!1),r=c("none"!=a.transform?a.transform:"matrix(1,0,0,1,0,0)"),l=a["transform-origin"].split(" "),f=M(r),h=w(l[0]),u=w(l[1]);f.origin={x:h,y:u}}return f}(t)}function q(t,e){var n=e.pageX-t.pageX,o=e.pageY-t.pageY;return{offsetx:n,offsety:o,length:Math.sqrt(n*n+o*o)}}function f(t){var e=t.touches&&t.touches.length?t.touches:t.changedTouches&&t.changedTouches.length?t.changedTouches:[t],n={time:(new Date).getTime(),count:e.length,events:e};if(2==e.length){var o=e[0],i=e[1],s=q(o,i),a=s.offsetx,r=s.offsety,l=s.length,f=Math.sqrt(l*l/4-r*r/4),h=o.pageY+r/2,u=o.pageX+(a<0?-f:f);n.length=l,n.center={pageX:u,pageY:h}}return n}function A(t,e,n){var o,i=[e,n],s=this.events,a=this.element,r=n.events[0].target;if(s=this.events[t]){t:for(;r!=a;){var l=r.getAttribute("__gid");if(l){o=s[l];break t}var f=(r.className||"").split(" ");e:for(var h=0;h<f.length;h++){var u=f[h];if(u&&s[u]){r.setAttribute("__gid",u),o=s[u];break e}}if(o)break t;r=r.parentNode}o=o||s[p]}o&&o.apply(new v(r),i)}function e(){function T(t){return-1<P.enabled.indexOf(t)}function o(t){t.preventDefault(),t.stopPropagation()}function t(t){o(t),k=f(t),A.call(P,"start",k,k),i.addEventListener(l?"touchmove":"mousemove",a,!1),i.addEventListener(l?"touchend":"mouseup",r,!1),i.addEventListener(l?"touchcancel":"mouseleave",r,!1)}var _,E,k,L,P=this,i=this.element,O=function(){if(k&&L){var t=k.events,e=L.events,n=q(t[0],e[0]);if(1==k.count&&1==L.count&&T("slide")&&3<n.length){var o={x:n.offsetx,y:n.offsety};E=E||{x:0,y:0},L.translate={x:o.x-E.x,y:o.y-E.y},E=o,_="slide"}else if(2==k.count&&2==L.count){var i=k.length,s=L.length,a=Math.PI/180,r=s/i,l=q(e[1],t[1]),f=n.length+l.length,h=(i*i+s*s-f*f)/(2*i*s),u=Math.acos(h<-1?-1:1<h?1:h)/a;if(!_)if(T("pinch")&&T("rotate"))if(.02<Math.abs(r-1))_="pinch";else{if(!(1<Math.abs(u)))return;_="rotate"}else _=T("pinch")?"pinch":"rotate";if("pinch"==_)null==E&&(E=1),L.scale=r/E,E=r;else if("rotate"==_&&null!=u){null==E&&(E=0);var c=k.center,v=t[0],g=e[0],p=q(c,v),d=q(c,g),m=t[1],x=e[1],y=q(c,m),b=q(c,x),w=p.offsetx*d.offsety-p.offsety*d.offsetx,M=y.offsetx*b.offsety-y.offsety*b.offsetx;u=w<0||M<0?-u:u,L.rotate=u-E,E=u}}L.total=E,_&&A.call(P,_,L,k),X(O)}},s=!1,a=function(t){o(t),L=f(t),!s&&(T("slide")||T("roate")||T("pinch"))&&(X(O),s=!0)},r=function(t){if(!t.touches||0==t.touches.length){o(t);k.events;var e=f(t),n=(e.events,e.time-k.time);e.duration=n,_?A.call(P,_+"End",e,k):function(t,e){var n=t.duration,o=this.__lastTouch,i=o&&t.time-o.time<300?"doubletap":n<200?"tap":"longtap";if("tap"==i&&(this.__lastTouch=t),setTimeout(function(){P.__lastTouch=null},300),"tap"==i&&T("doubletap")){var s=setTimeout(function(){A.call(P,"tap",t,e)},300);this.__lastTouch.itv=s}else o&&o.itv&&clearTimeout(o.itv),T(i)&&A.call(this,i,t,e)}.call(P,e,k),L=k=null,s=!1,E=_=void 0,i.removeEventListener(l?"touchmove":"mousemove",a,!1),i.removeEventListener(l?"touchend":"mouseup",r,!1),i.removeEventListener(l?"touchcancel":"mouseleave",r,!1)}};return i.addEventListener(l?"touchstart":"mousedown",t,!1),t}function n(t){this.element=t||document.body,this.events={},this.enabled=["tap"],this.element.setAttribute("__gid",p),this.__evtfn=e.call(this)}var X=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},p="besom-gid-root";return n.prototype={enable:function(){for(var t=["tap","longtap","doubletap","slide","pinch","rotate"],e=0;e<arguments.length;e++){var n=arguments[e];if(!(-1<t.indexOf(n)))throw new Error('Only Support: "'+t.join("|")+'"!');this.enabled.indexOf(n)<0&&this.enabled.push(n)}},disable:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t],n=this.enabled.indexOf(e);-1<n&&this.enabled.splice(n,1)}},on:function(t,e){this.events[t]=this.events[t]||{},this.events[t][p]=e},delegate:function(t,e,n){if(t.indexOf(".")<0)throw new Error('The arguments[0] shoud start width "."!');t=t.substring(1),this.events[e]=this.events[e]||{},this.events[e][t]=n},destroy:function(){this.element.removeEventListener(l?"touchstart":"mousedown",this.__evtfn,!1),this.__evtfn,this.element=null,this.events={}}},{create:function(t){return new n(t)},element:function(t){return new v(t)}}});